name: XP Automation

on:
  schedule:
    - cron: '5 */4 * * *'
  workflow_dispatch:

permissions:
  contents: read

jobs:
  send-xp:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Run XP request
        run: |
          echo "‚è≥ Waiting 10 seconds..."
          sleep 10
          echo "üì§ Sending XP request..."
          
          TOKEN="${{ secrets.DUOLINGO_TOKEN }}"
          
          if [ -z "$TOKEN" ]; then
            echo "‚ùå Error: DUOLINGO_TOKEN secret is not set"
            exit 1
          fi
          
          # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç –∏–∑ –≤–∞—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
          PAYLOAD='{
            "type": "xp",
            "amount": 30000,
            "version": "3.1BETA.03"
          }'
          
          echo "Using token length: ${#TOKEN} characters"
          echo "Payload: $PAYLOAD"
          
          # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
          curl -v --ssl-no-revoke -X POST https://api.duolingopro.net/request \
            -H "Authorization: Bearer $TOKEN" \
            -H "Content-Type: application/json" \
            -H "Accept: application/json" \
            -d "$PAYLOAD" \
            --write-out "\nHTTP Status: %{http_code}\n"

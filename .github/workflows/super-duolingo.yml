name: Super Automation

on:
  schedule:
    - cron: '0 0 * * *'  # ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ² Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ‡ÑŒ (UTC)
  workflow_dispatch:        # Ğ ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº

permissions:
  contents: read

jobs:
  request-super:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Request 3 Days of Super
        run: |
          echo "ğŸš€ Starting Super automation..."
          echo "â³ Waiting 10 seconds before request..."
          sleep 10
          
          TOKEN="${{ secrets.DUOLINGO_TOKEN }}"
          if [ -z "$TOKEN" ]; then
            echo "âŒ ERROR: DUOLINGO_TOKEN secret is not set"
            exit 1
          fi
          
          echo "ğŸ“¤ Requesting 3 Days of Super..."
          
          RESPONSE=$(curl --silent --ssl-no-revoke -X POST https://api.duolingopro.net/request \
            -H "Authorization: Bearer $TOKEN" \
            -H "Content-Type: application/json" \
            -H "Accept: text/event-stream" \
            -d '{"type": "super", "amount": 1, "version": "3.1BETA.03"}')
          
          # Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµĞ¼ Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚
          FINAL_RESPONSE=$(echo "$RESPONSE" | grep '"status": "completed"' | tail -n1 | sed 's/^data: //')
          
          if [ -z "$FINAL_RESPONSE" ]; then
            FINAL_RESPONSE=$(echo "$RESPONSE" | tail -n1 | sed 's/^data: //')
          fi
          
          echo "ğŸ“‹ Server response:"
          echo "$FINAL_RESPONSE" | jq '.' 2>/dev/null || echo "$FINAL_RESPONSE"
          
          if echo "$FINAL_RESPONSE" | grep -q '"status": "completed"'; then
            echo "âœ… Request successfully processed by server!"
            echo "ğŸ“… Attempted to add: 3 Days of Super"
            echo "ğŸ’¡ Note: Check your Duolingo account to confirm"
            echo "ğŸ”„ Next attempt: Available in 1 day"
          else
            echo "âŒ Request failed"
            exit 1
          fi
          
          echo "âœ¨ Automation completed at: $(date -u '+%H:%M:%S UTC')"

      - name: Log completion
        run: |
          echo "ğŸ“ Log entry: Super request attempted"
          echo "Timestamp: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          echo "Status: Request sent to Duolingo PRO API"
          echo "Action required: Verify in Duolingo app/website"
